<div id="app-screen" class="hidden max-w-md mx-auto min-h-screen bg-[#F2F2F7] relative overflow-hidden flex flex-col">
    <header class="bg-[#F2F2F7] px-5 pt-12 pb-2 flex items-center justify-between sticky top-0 z-10">
        <div class="flex flex-col">
            <h1 class="text-2xl font-bold text-gray-900 tracking-tight">我的帳本</h1>
            <div class="flex items-center gap-2 mt-1">
                <span id="current-view-label" class="text-xs font-medium text-gray-500 bg-gray-200 px-2 py-0.5 rounded-md">個人</span>
                <span id="sync-status" class="text-[10px] text-green-600">已同步</span>
            </div>
        </div>
        <div class="bg-gray-200 p-0.5 rounded-lg flex text-xs font-medium relative">
            <select id="filter-type" onchange="changeFilterMode()" class="bg-transparent appearance-none px-3 py-1 text-gray-600 focus:outline-none z-10 relative">
                <option value="day">日</option>
                <option value="month" selected>月</option>
                <option value="year">年</option>
            </select>
            </div>
    </header>

    <main class="flex-1 overflow-y-auto px-5 pb-32 no-scrollbar">
        
        <div id="dashboard-card" class="mt-4 bg-white rounded-2xl p-6 shadow-sm border border-gray-100 relative overflow-hidden">
            <div class="flex justify-between items-start mb-2">
                <span class="text-gray-400 text-xs font-medium tracking-wide uppercase">本月結餘</span>
                <button onclick="toggleChart()" class="text-blue-500 text-xs font-bold bg-blue-50 px-2 py-1 rounded-full">圖表</button>
            </div>
            <div class="text-3xl font-extrabold text-gray-900 mb-6 tracking-tight" id="display-balance">$ 0</div>
            
            <div class="flex gap-4">
                <div class="flex-1">
                    <span class="text-[10px] text-gray-400 block mb-0.5">收入</span>
                    <div class="font-bold text-green-500 text-lg" id="display-income">0</div>
                </div>
                <div class="w-px bg-gray-100 h-8 self-center"></div>
                <div class="flex-1">
                    <span class="text-[10px] text-gray-400 block mb-0.5">支出</span>
                    <div class="font-bold text-red-500 text-lg" id="display-expense">0</div>
                </div>
            </div>

            <div id="chart-container" class="hidden mt-6 pt-6 border-t border-gray-100 fade-in">
                <div class="h-48 w-full flex justify-center">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>

        <div id="transaction-list" class="mt-6 space-y-2">
            </div>
        <div id="empty-state" class="hidden py-20 text-center">
            <div class="text-4xl mb-2">🐕</div>
            <p class="text-gray-400 text-sm">這個月還沒有記帳喔</p>
        </div>
    </main>

    <nav class="fixed bottom-0 w-full bg-white/90 backdrop-blur-md border-t border-gray-200 pb-safe pt-2 px-6 flex justify-between items-end z-30 h-20">
        <button onclick="switchView(currentUser.uid, '我的帳本')" class="flex flex-col items-center gap-1 w-16 pb-2 text-blue-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>
            <span class="text-[10px] font-medium">帳戶</span>
        </button>

        <button onclick="openInputModal()" class="mb-4 bg-gray-900 text-white rounded-full w-14 h-14 shadow-lg shadow-blue-900/20 flex items-center justify-center transform transition active:scale-95 hover:bg-black">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>

        <button onclick="toggleFriendModal()" class="flex flex-col items-center gap-1 w-16 pb-2 text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
            <span class="text-[10px] font-medium">好友</span>
        </button>
        
        <button onclick="toggleProfileModal()" class="flex flex-col items-center gap-1 w-16 pb-2 text-gray-400 hover:text-gray-600 hidden"> 
            </button>
    </nav>

    <div id="input-modal" class="fixed inset-0 bg-black/40 z-50 hidden flex flex-col justify-end fade-in">
        <div class="bg-white w-full rounded-t-3xl p-6 shadow-2xl animate-slide-up h-[70vh] flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <button onclick="closeInputModal()" class="text-gray-400 p-2">取消</button>
                <h2 class="text-lg font-bold" id="form-title">新增一筆</h2>
                <button onclick="document.getElementById('transaction-form').dispatchEvent(new Event('submit', {cancelable: true, bubbles: true}))" class="text-blue-600 font-bold p-2">完成</button>
            </div>
            
            <form id="transaction-form" class="flex flex-col gap-4 flex-1">
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-2xl text-gray-400">$</span>
                    <input type="number" id="inp-amount" placeholder="0" class="w-full bg-gray-50 border-none rounded-2xl py-4 pl-10 pr-4 text-4xl font-bold text-gray-900 text-center focus:ring-0" required inputmode="decimal">
                </div>

                <div class="bg-gray-100 p-1 rounded-xl flex">
                    <select id="inp-type" onchange="updateCategoryOptions()" class="bg-transparent w-20 text-center text-sm font-bold text-gray-600 focus:outline-none"><option value="expense">支出</option><option value="income">收入</option></select>
                    <div class="w-px bg-gray-300 my-1"></div>
                    <select id="inp-category" class="flex-1 bg-transparent px-4 text-sm font-bold text-gray-800 focus:outline-none appearance-none text-center"></select>
                </div>

                <div class="flex gap-3">
                    <input type="date" id="inp-date" class="bg-gray-50 border-none rounded-xl px-4 py-3 text-sm text-gray-600 w-1/3">
                    <input type="text" id="inp-title" placeholder="寫點備註..." class="flex-1 bg-gray-50 border-none rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 focus:ring-2 focus:ring-blue-100">
                </div>

                <div class="flex gap-3 mt-2">
                    <input type="file" id="inp-photo" accept="image/*" onchange="handlePhotoSelect(event)" class="hidden">
                    <label for="inp-photo" id="btn-camera" class="w-full border-2 border-dashed border-gray-200 rounded-xl py-4 flex flex-col items-center justify-center text-gray-400 hover:border-blue-400 hover:text-blue-500 transition cursor-pointer">
                        <span class="text-2xl mb-1">📷</span>
                        <span class="text-xs font-bold">加入照片</span>
                    </label>
                    <div id="preview-container" class="hidden relative w-full h-32">
                        <img id="img-preview" class="w-full h-full object-cover rounded-xl">
                        <button type="button" onclick="clearPhoto()" class="absolute top-2 right-2 bg-black/50 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs backdrop-blur-sm">✕</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    </div>
